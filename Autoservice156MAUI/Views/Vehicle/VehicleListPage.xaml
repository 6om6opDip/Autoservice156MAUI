<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Autoservice156MAUI.ViewModels.Vehicle"
             x:Class="Autoservice156MAUI.Views.Vehicle.VehicleListPage"
             Title="Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ" Command="{Binding AddVehicleCommand}" />
        <ToolbarItem Text="âŸ³" Command="{Binding RefreshCommand}" />
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ñ Ð¸Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð¾Ð¼ API -->
        <Frame Grid.Row="0" 
               Margin="10" 
               Padding="15" 
               CornerRadius="10"
               BackgroundColor="{Binding ApiStatusColor}">
            <HorizontalStackLayout Spacing="10">
                <Label Text="ðŸš— Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚Ð½Ñ‹Ðµ ÑÑ€ÐµÐ´ÑÑ‚Ð²Ð°" 
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center"/>

                <Frame Padding="8,4" 
                       CornerRadius="6" 
                       BackgroundColor="{Binding ApiStatusColor}">
                    <HorizontalStackLayout Spacing="6">
                        <Label Text="{Binding ApiStatusText}" 
                               FontSize="12"
                               TextColor="White"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Frame>
            </HorizontalStackLayout>
        </Frame>

        <!-- ÐŸÐ¾Ð¸ÑÐº Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº -->
        <VerticalStackLayout Grid.Row="1" Spacing="10" Padding="10">

            <SearchBar Placeholder="ÐŸÐ¾Ð¸ÑÐº Ñ‚Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚Ð°..."
                       Text="{Binding SearchText}"
                       Margin="0,0,0,10"/>

            <RefreshView Command="{Binding RefreshCommand}"
                         IsRefreshing="{Binding IsBusy}">
                <CollectionView ItemsSource="{Binding FilteredVehicles}"
                                SelectionMode="Single">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Padding="15" 
                                   Margin="0,0,0,10"
                                   BorderColor="#E0E0E0"
                                   CornerRadius="10">
                                <VerticalStackLayout Spacing="8">
                                    <Label Text="{Binding FullName}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="#333333"/>

                                    <HorizontalStackLayout Spacing="15">
                                        <Label Text="{Binding LicensePlate}"
                                               FontSize="13"
                                               TextColor="#512BD4"/>
                                        <Label Text="â€¢"
                                               FontSize="13"
                                               TextColor="#999999"/>
                                        <Label Text="{Binding Year, StringFormat='Ð“Ð¾Ð´: {0}'}"
                                               FontSize="13"
                                               TextColor="#666666"/>
                                    </HorizontalStackLayout>

                                    <Label Text="{Binding VIN}"
                                           FontSize="12"
                                           TextColor="#999999"/>
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                    <CollectionView.EmptyView>
                        <VerticalStackLayout HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             Spacing="15"
                                             Padding="40">
                            <Label Text="ðŸš—"
                                   FontSize="40"
                                   HorizontalOptions="Center"/>
                            <Label Text="Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
                                   FontSize="16"
                                   HorizontalOptions="Center"/>
                            <Button Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddVehicleCommand}"
                                    BackgroundColor="#512BD4"
                                    TextColor="White"
                                    CornerRadius="10"
                                    HeightRequest="45"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>
                </CollectionView>
            </RefreshView>

        </VerticalStackLayout>

        <ActivityIndicator IsRunning="{Binding IsBusy}"
                          IsVisible="{Binding IsBusy}"
                          Grid.RowSpan="3"
                          HorizontalOptions="Center"
                          VerticalOptions="Center"
                          Color="#512BD4"/>

        <Label Text="{Binding ErrorMessage}"
               Grid.Row="2"
               Margin="20"
               TextColor="Red"
               IsVisible="{Binding HasError}"
               HorizontalOptions="Center"/>
    </Grid>
</ContentPage>